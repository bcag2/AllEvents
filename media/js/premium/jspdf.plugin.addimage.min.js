/** @preserve
jsPDF addImage plugin (JPEG only at this time)
Copyright (c) 2012 https://github.com/siefkenj/
*/

/**
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * ====================================================================
 */
(function(e){"use strict";var t="addImage_";var n=function(e){"use strict";var t,n;if(!e.charCodeAt(0)===255||!e.charCodeAt(1)===216||!e.charCodeAt(2)===255||!e.charCodeAt(3)===224||!e.charCodeAt(6)==="J".charCodeAt(0)||!e.charCodeAt(7)==="F".charCodeAt(0)||!e.charCodeAt(8)==="I".charCodeAt(0)||!e.charCodeAt(9)==="F".charCodeAt(0)||!e.charCodeAt(10)===0){throw new Error("getJpegSize requires a binary jpeg file")}var r=e.charCodeAt(4)*256+e.charCodeAt(5);var i=4,s=e.length;while(i<s){i+=r;if(e.charCodeAt(i)!==255){throw new Error("getJpegSize could not find the size of the image")}if(e.charCodeAt(i+1)===192||e.charCodeAt(i+1)===193||e.charCodeAt(i+1)===194||e.charCodeAt(i+1)===195||e.charCodeAt(i+1)===196||e.charCodeAt(i+1)===197||e.charCodeAt(i+1)===198||e.charCodeAt(i+1)===199){n=e.charCodeAt(i+5)*256+e.charCodeAt(i+6);t=e.charCodeAt(i+7)*256+e.charCodeAt(i+8);return[t,n]}else{i+=2;r=e.charCodeAt(i)*256+e.charCodeAt(i+1)}}},r=function(e){var t=this.internal.newObject(),n=this.internal.write,r=this.internal.putStream;e["n"]=t;n("<</Type /XObject");n("/Subtype /Image");n("/Width "+e["w"]);n("/Height "+e["h"]);if(e["cs"]==="Indexed"){n("/ColorSpace [/Indexed /DeviceRGB "+(e["pal"].length/3-1)+" "+(t+1)+" 0 R]")}else{n("/ColorSpace /"+e["cs"]);if(e["cs"]==="DeviceCMYK"){n("/Decode [1 0 1 0 1 0 1 0]")}}n("/BitsPerComponent "+e["bpc"]);if("f"in e){n("/Filter /"+e["f"])}if("dp"in e){n("/DecodeParms <<"+e["dp"]+">>")}if("trns"in e&&e["trns"].constructor==Array){var i="";for(var s=0;s<e["trns"].length;s++){i+=e[i][s]+" "+e["trns"][s]+" ";n("/Mask ["+i+"]")}}if("smask"in e){n("/SMask "+(t+1)+" 0 R")}n("/Length "+e["data"].length+">>");r(e["data"]);n("endobj")},i=function(){var e=this.internal.collections[t+"images"];for(var n in e){r.call(this,e[n])}},s=function(){var e=this.internal.collections[t+"images"],n=this.internal.write,r;for(var i in e){r=e[i];n("/I"+r["i"],r["n"],"0","R")}};e.addImage=function(e,r,o,u,a,f){"use strict";if(typeof e==="object"&&e.nodeType===1){var l=document.createElement("canvas");l.width=e.clientWidth;l.height=e.clientHeight;var c=l.getContext("2d");if(!c){throw"addImage requires canvas to be supported by browser."}c.drawImage(e,0,0,l.width,l.height);e=l.toDataURL("image/jpeg");r="JPEG"}if(r.toUpperCase()!=="JPEG"){throw new Error("addImage currently only supports format 'JPEG', not '"+r+"'")}var h,p=this.internal.collections[t+"images"],d=this.internal.getCoordinateString,v=this.internal.getVerticalCoordinateString;if(e.substring(0,23)==="data:image/jpeg;base64,"){e=atob(e.replace("data:image/jpeg;base64,",""))}if(p){h=Object.keys?Object.keys(p).length:function(e){var t=0;for(var n in e){if(e.hasOwnProperty(n)){t++}}return t}(p)}else{h=0;this.internal.collections[t+"images"]=p={};this.internal.events.subscribe("putResources",i);this.internal.events.subscribe("putXobjectDict",s)}var m=n(e);var g={w:m[0],h:m[1],cs:"DeviceRGB",bpc:8,f:"DCTDecode",i:h,data:e};p[h]=g;if(!a&&!f){a=-96;f=-96}if(a<0){a=-1*g["w"]*72/a/this.internal.scaleFactor}if(f<0){f=-1*g["h"]*72/f/this.internal.scaleFactor}if(a===0){a=f*g["w"]/g["h"]}if(f===0){f=a*g["h"]/g["w"]}this.internal.write("q",d(a),"0 0",d(f),d(o),v(u+f),"cm /I"+g["i"],"Do Q");return this}})(jsPDF.API)