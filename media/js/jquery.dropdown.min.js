//Title: Custom DropDown plugin by PC & RemableDesigns
//Documentation: http://designwithpc.com/Plugins/ddslick & http://demo.remabledesigns.com/ddslickremablized/
//Author: PC & Robert E. McIntosh
//Website: http://designwithpc.com & http://www.remabledesigns.com./
//Twitter: http://twitter.com/chaudharyp & http://twitter.com/mouse0270
(function(e){function s(e,t){var n=e.data("ddslick");var r=e.find(".dd-selected"),i=r.siblings(".dd-selected-value"),s=e.find(".dd-options"),o=r.siblings(".dd-pointer"),f=e.find(".dd-option").eq(t),l=f.closest("li"),c=n.settings,h=n.settings.data[t];if(!e.attr("multiple")){e.find(".dd-option").removeClass("dd-option-selected");f.addClass("dd-option-selected")}else{if(e.find(".dd-option").eq(t).hasClass("dd-option-selected"))e.find(".dd-option").eq(t).removeClass("dd-option-selected");else f.addClass("dd-option-selected")}n.selectedIndex=t;n.selectedItem=l;n.selectedData=h;if(typeof c.onSelected=="function"&&r.text().length>0){c.onSelected.call(this,n)}if(r.text().length==0||!c.resetmenu){if(c.showSelectedHTML){r.html((h.imageSrc?'<img class="dd-selected-image'+(c.imagePosition=="right"?" dd-image-right":"")+'" src="'+h.imageSrc+'" />':"")+(h.text?'<label class="dd-selected-text" style="cursor:pointer;">'+h.text+"</label>":"")+(h.description?'<small class="dd-selected-description dd-desc'+(c.truncateDescription?" dd-selected-description-truncated":"")+'" >'+h.description+"</small>":""))}else r.html(h.text)}i.val(h.value);n.original.val(h.value);e.data("ddslick",n);u(e);a(e)}function o(t){if(!t.hasClass("dd-disabled")){t.find("ul li a");var n=t.find(".dd-select"),r=n.siblings(".dd-options"),i=n.find(".dd-pointer"),s=r.is(":visible");e(".dd-click-off-close").not(r).slideUp(50);e(".dd-pointer").removeClass("dd-pointer-up");r.find("a").each(function(){e(this).removeClass("dd-option-hover")});if(s){r.slideUp("fast");i.removeClass("dd-pointer-up")}else{r.slideDown("fast");i.addClass("dd-pointer-up")}f(t)}}function u(e){if(!e.attr("multiple")){e.find(".dd-options").slideUp(50);e.find(".dd-pointer").removeClass("dd-pointer-up").removeClass("dd-pointer-up")}}function a(e){var t="14px";var n=e.find(".dd-selected-description");var r=e.find(".dd-selected-image");if(n.length<=0&&r.length>0){e.find(".dd-selected-text").css("lineHeight",t)}}function f(t){t.find(".dd-option").each(function(){var n=e(this);var r=n.css("height");r="20px";var i=n.find(".dd-option-description");var s=t.find(".dd-option-image");if(i.length<=0&&s.length>0){n.find(".dd-option-text").css("lineHeight",r)}})}e.fn.ddslick=function(n){if(t[n]){return t[n].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof n==="object"||!n){return t.init.apply(this,arguments)}else{e.error("Method "+n+" does not exists.")}};var t={},n={data:[],keepJSONItemsOnTop:false,width:260,height:null,background:"#eee",selectText:"",defaultSelectedIndex:null,truncateDescription:true,imagePosition:"left",showSelectedHTML:true,clickOffToClose:true,onSelected:function(){},defaultTarget:"_blank",resetmenu:false,enableKeyboard:true,keyboard:[{up:38,down:40,select:13}]},r='<div class="dd-select"><input class="dd-selected-value" type="hidden" /><a class="dd-selected"></a><span class="dd-pointer dd-pointer-down"></span></div>',i='<ul class="dd-options"></ul>';t.init=function(t){var u=t;return this.each(function(){var t=e.extend({},n,u);var a=e(this),f=a.data("ddslick"),l=a.attr("name");if(!f){var c=[],h=t.data;a.find("option").each(function(){var n=e(this),r=n.data();if(n.attr("data-href")&&!n.attr("data-target"))n.attr("data-target",t.defaultTarget);c.push({text:e.trim(n.text()),value:n.val(),selected:n.is(":selected"),description:r.description,imageSrc:r.imagesrc,href:n.attr("data-href"),target:n.attr("data-target")})});if(t.keepJSONItemsOnTop)e.merge(t.data,c);else t.data=e.merge(c,t.data);var p=a,d=e("<div></div>");var v=p[0].attributes;for(var m=0;m<v.length;m++){d.attr(v[m].nodeName,v[m].nodeValue)}a.replaceWith(d);a=d;a.addClass("dd-container").append(r).append(i);e("input",a).attr("name",l);var c=a.find(".dd-select"),g=a.find(".dd-options");g.css({width:t.width});c.css({width:t.width});a.css({width:t.width});if(t.height!=null)g.css({height:t.height,overflow:"auto"});e.each(t.data,function(e,n){g.append("<li>"+'<div class="dd-option">'+(n.value?' <input class="dd-option-value" type="hidden" value="'+n.value+'" />':"")+(n.imageSrc?' <img class="dd-option-image'+(t.imagePosition=="right"?" dd-image-right":"")+'" src="'+n.imageSrc+'" />':"")+(n.text?' <label class="dd-option-text" style="cursor:pointer;">'+n.text+"</label>":"")+(n.description?' <small class="dd-option-description dd-desc">'+n.description+"</small>":"")+"</div>"+"<a "+(n.href===undefined?"":'href="'+n.href+'" target="'+n.target+'"')+"></a>"+"</li>")});var y={settings:t,original:p,selectedIndex:-1,selectedItem:null,selectedData:null};a.data("ddslick",y);if(t.selectText.length>0&&t.defaultSelectedIndex==null){a.find(".dd-selected").html(t.selectText)}else{var b=t.defaultSelectedIndex!=null&&t.defaultSelectedIndex>=0&&t.defaultSelectedIndex<t.data.length?t.defaultSelectedIndex:0;s(a,b)}var w=g.parent().find(".dd-selected-value").val(),E=g.find("li").size()-2;var S=false;a.find(".dd-select").on("click.ddslick",function(){w=a.find(".dd-option-selected").parent().index();E=a.find("ul").find("li").size()-2;o(a);S=true});a.find(".dd-option").on("click.ddslick",function(){s(a,e(this).closest("li").index());S=false});if(t.clickOffToClose&&!a.attr("multiple")){g.addClass("dd-click-off-close");a.on("click.ddslick",function(e){e.stopPropagation()});e("body").on("click",function(){e(".dd-click-off-close").slideUp(50).siblings(".dd-select").find(".dd-pointer").removeClass("dd-pointer-up");S=false})}e(document).keydown(function(e){if(S==true&&t.enableKeyboard==true){if(e.keyCode==t.keyboard[0].down){g.find("li").eq(w).find("a").removeClass("dd-option-hover");w<=E?w++:w=0;g.find("li").eq(w).find("a").addClass("dd-option-hover")}else if(e.keyCode==t.keyboard[0].up){g.find("li").eq(w).find("a").removeClass("dd-option-hover");w>=0?w--:w=E;g.find("li").eq(w).find("a").addClass("dd-option-hover")}else if(e.keyCode==t.keyboard[0].select){s(a,g.find("li").eq(w).index());if(g.find("li").eq(w).find("a").attr("href"))window.open(g.find("li").eq(w).find("a").attr("href"),g.find("li").eq(w).find("a").attr("target"));S=false}return false}else{return true}});g.find("li").on("mouseover",function(){e(this).parent().find(".dd-option-hover").removeClass("dd-option-hover");w=e(this).index()});if(a.attr("multiple")){a.find(".dd-selected").css({display:"none"});a.find(".dd-options").css({display:"block",position:"relative",zIndex:"1"})}}})};t.selectedData=function(){var t=e(this),n=t.find(".dd-options").find("li").find(".dd-option-selected"),r=[],i=null;n.each(function(t){r.push({text:e(this).find(".dd-option-text").text(),value:e(this).find("input").val(),description:e(this).find(".dd-option-description").text(),imageSrc:e(this).find(".dd-option-image").attr("src"),href:e(this).attr("href"),target:e(this).attr("target")})});return r};t.disable=function(){return this.each(function(){var t=e(this);t.addClass("dd-disabled")})};t.enable=function(){return this.each(function(){var t=e(this);if(t.hasClass("dd-disabled"))t.removeClass("dd-disabled")})};t.select=function(t){return this.each(function(){if(t.index!=null)s(e(this),t.index)})};t.open=function(){return this.each(function(){var t=e(this),n=t.data("ddslick");if(n)o(t)})};t.close=function(){return this.each(function(){var t=e(this),n=t.data("ddslick");if(n)u(t)})};t.destroy=function(){return this.each(function(){var t=e(this),n=t.data("ddslick");if(n){var r=n.original;t.removeData("ddslick").unbind(".ddslick").replaceWith(r)}})}})(jQuery)