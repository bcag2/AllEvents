/*
 *  Bic Calendar - v3.2.2
 *  A simple twitter bootstrap calendar / agenda to mark events and select range of dates.
 *  http://bichotll.github.io/bic_calendar
 *
 *  Made by bichotll
 *  Under Apache License
 */
(function(e){e.fn.bic_calendar=function(t){var n=e.extend({},e.fn.bic_calendar.defaults,t);this.each(function(){function N(){i=e('<table class="table">');k();var n=f.getMonth();var a=f.getFullYear();L(n,a);var l=e('<td><a href="#" class="button-month-next"><i class="icon-arrow-right"></i></a></td>');l.click(function(e){e.preventDefault();n=(n+1)%12;if(n===0)a++;C(n,a)});var c=e('<td><a href="#" class="button-month-previous"><i class="icon-arrow-left"></i></a></td>');c.click(function(e){e.preventDefault();n=n-1;if(n==-1){a--;n=11}C(n,a)});var h=e('<td><a href="#" class="button-year-next"><i class="icon-arrow-right"></i></a></td>');h.click(function(e){e.preventDefault();a++;C(n,a)});var p=e('<td><a href="#" class="button-year-previous"><i class="icon-arrow-left"></i></a></td>');p.click(function(e){e.preventDefault();a--;C(n,a)});var d=e('<table class="table"></table>');if(w===true){var v=e("<tr></tr>");var m=e('<td colspan=5 class="monthAndYear span6"></td>');v.append(p);v.append(m);v.append(h);m.append(o);d.append(v)}if(b===true){var g=e("<tr></tr>");var y=e('<td colspan=5 class="monthAndYear span6"></td>');g.append(c);g.append(y);g.append(l);y.append(s);d.append(g)}r=e('<div class="bic_calendar" id="'+u+'" ></div>');r.prepend(d);r.append(i);t.append(r);D(n,a);H()}function C(e,t){i.empty();k();L(e,t);D(e,t);B()}function k(){if(p!==false){var t=e('<tr class="days-month" >');var n="";e(c).each(function(e,t){n+="<td";if(e===0){n+=' class="first"'}if(e===6){n+=' class="sunday last"'}n+=">"+t+"</td>"});n+="</tr>";t.append(n);i.append(t)}}function L(e,t){s.text(h[e]);o.text(t);var n=1;var r=A(1,e,t);var a=M(e,t);var f=e+1;var l="";for(var c=0;c<7;c++){if(c<r){var p="";if(c===0)p+="<tr>";p+='<td class="invalid-day week-day-'+c+'"';p+='"></td>'}else{var p="";if(c===0)p+="<tr>";p+='<td id="'+u+"_"+n+"_"+f+"_"+t+'" data-date="'+f+"/"+n+"/"+t+'" ';p+=' class="day week-day-'+c+'"';p+="><div><a>"+n+"</a></div></span>";if(c==6)p+="</tr>";n++}l+=p}var d=1;while(n<=a){var p="";if(d%7==1)p+="<tr>";p+='<td id="'+u+"_"+n+"_"+f+"_"+t+'" data-date="'+f+"/"+n+"/"+t+'" ';p+=' class="day week-day-'+(d-1)%7+'"';p+="><div><a>"+n+"</a></div></td>";if(d%7===0)p+="</tr>";n++;d++;l+=p}d--;if(d%7!==0){p="";for(var c=d%7+1;c<=7;c++){var p="";p+="<td ";p+=' class="invalid-day week-day-'+(c-1)+'"';p+='"></td>';if(c==7)p+="</tr>";l+=p}}i.append(l)}function A(e,t,n){var r=new Date(n,t,e);var i=r.getDay();i+=E;if(i===0)i=6;else i--;return i}function O(e,t,n){return e>0&&e<13&&n>0&&n<32768&&t>0&&t<=(new Date(n,e,0)).getDate()}function M(e,t){var n=28;while(O(e+1,n+1,t)){n++}return n}function _(e){var t=e.split("/");if(t.length!=3)return false;return O(t[1],t[0],t[2])}function D(t,n){if(m!==false){e.ajax({type:m.type,url:m.url,data:{mes:t+1,ano:n},dataType:"json"}).done(function(r){if(typeof a=="undefined")a=[];e.each(r,function(e,t){a.push(r[e])});P(t,n)})}else{P(t,n)}}function P(t,n){var r=t+1;if(typeof a=="undefined")a=[];for(var i=0;i<a.length;i++){if(a[i].date.split("/")[1]==r&&a[i].date.split("/")[2]==n){var s=e("#"+u+"_"+a[i].date.replace(/\//g,"_"));var o=e("#"+u+"_"+a[i].date.replace(/\//g,"_")+" a");s.addClass("event");o.attr("data-original-title",a[i].title);if(a[i].color)s.css("background",a[i].color);if(typeof a[i].link!=="undefined"&&a[i].link!==""){o.attr("href",a[i].link)}if(typeof a[i].linkTarget!=="undefined"&&a[i].linkTarget!==""){o.attr("target",a[i].linkTarget)}if(a[i].class)s.addClass(a[i].class);if(a[i].content){s.addClass("event_popover");o.attr("rel","popover");o.attr("data-content",a[i].content)}else{s.addClass("event_tooltip");o.attr("rel","tooltip")}}}e("#"+u+" "+".event_tooltip a").tooltip(v);e("#"+u+" "+".event_popover a").popover(d);e(".manual_popover").click(function(){e(this).popover("toggle")})}function H(){if(g===true){var n;t.on("click","td.day",function(){if(y===true){if(T===""){T=e(this).data("date");B()}else{if(x===""){S=T;x=e(this).data("date");B();var n=new CustomEvent("bicCalendarSelect",{detail:{dateFirst:S,dateLast:x}});document.dispatchEvent(n)}else{S="";x="";T="";t.find(".selection").removeClass("middle-selection selection first-selection last-selection")}}}else{t.find("td div").removeClass("selection");e(this).find("div").addClass("selection");var n=new CustomEvent("bicCalendarSelect",{detail:{date:e(this).data("date")}});document.dispatchEvent(n)}})}}function B(){if(T!==""&&S===""){var n=T.split("/");e("#bic_calendar_"+n[1]+"_"+n[0]+"_"+n[2]+" div").addClass("selection")}else if(S!==""){var r=S.split("/");var i=x.split("/");t.find("td.selection").removeClass("selection");var s=new Date(S);var o=new Date(x);if(s>o){var u=s;s=o;o=u}e("#bic_calendar_"+s.getDate()+"_"+(parseInt(s.getMonth())+1)+"_"+s.getFullYear()+" div").addClass("selection first-selection");while(s<o){s.setDate(s.getDate()+1);e("#bic_calendar_"+s.getDate()+"_"+(parseInt(s.getMonth())+1)+"_"+s.getFullYear()+" div").addClass("selection middle-selection")}e("#bic_calendar_"+s.getDate()+"_"+(parseInt(s.getMonth())+1)+"_"+s.getFullYear()+" div").removeClass("middle-selection").addClass("selection last-selection")}}var t=e(this);var r;var i;var s=e('<div class="visualmonth"></div>');var o=e('<div class="visualyear"></div>');var u="ae_bic_calendar";var a=n.events;var f;if(n.date){if(typeof n.date=="string"){var l=n.date.split("/");f=new Date(parseInt(l[2]),parseInt(l[1])-1,parseInt(l[0]))}else{f=n.date}}else{f=new Date}var c;if(typeof n.dayNames!="undefined")c=n.dayNames;else c=["l","m","x","j","v","s","d"];var h;if(typeof n.monthNames!="undefined")h=n.monthNames;else h=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];var p;if(typeof n.showDays!="undefined")p=n.showDays;else p=true;var d;if(typeof n.popoverOptions!="undefined")d=n.popoverOptions;else d={placement:"bottom",html:true,trigger:"hover"};var v;if(typeof n.tooltipOptions!="undefined")v=n.tooltipOptions;else v={placement:"bottom",trigger:"hover"};var m;if(typeof n.reqAjax!="undefined")m=n.reqAjax;else m=false;var g=false;if(typeof n.enableSelect!="undefined")g=n.enableSelect;var y=false;if(typeof n.multiSelect!="undefined")y=n.multiSelect;var b=true;if(typeof n.displayMonthController!="undefined")b=n.displayMonthController;var w=true;if(typeof n.displayYearController!="undefined")w=n.displayYearController;var E=0;if(typeof n.startWeekDay!="undefined")E=n.startWeekDay;var S="";var x="";var T="";N()});return this}})(jQuery)